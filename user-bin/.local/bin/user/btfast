#!/usr/bin/env bash
set -u

bt() { bluetoothctl "$@"; }

# đảm bảo bluetooth chạy
systemctl is-active --quiet bluetooth || sudo systemctl start bluetooth

devices=$(bluetoothctl devices Paired)
[ -z "$devices" ] && notify-send "Bluetooth" "No paired devices" && exit 0

choice=$(echo "$devices" | fzf --prompt="BT > ")
[ -z "$choice" ] && exit 0

mac=$(awk '{print $2}' <<<"$choice")
info=$(bluetoothctl info "$mac")

if grep -q "Connected: yes" <<<"$info"; then
  bt disconnect "$mac"
  notify-send "Bluetooth" "Disconnected"
else
  bt connect "$mac"
  notify-send "Bluetooth" "Connected"
fi
