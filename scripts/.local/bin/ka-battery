#!/bin/sh

# ==========================================
# 0. C·∫§U H√åNH M√ÄU S·∫ÆC (S·ª¨A T·∫†I ƒê√ÇY)
# ==========================================
# B·∫°n thay c√°c s·ªë sau d·∫•u ^C...^ ƒë·ªÉ kh·ªõp v·ªõi config.h c·ªßa b·∫°n
COL_GREEN="^C2^"        # M√†u xanh l√° (Th∆∞·ªùng l√† OK)
COL_LIGHTBLUE="^C6^"    # M√†u xanh nh·∫°t/Cyan
COL_YELLOW="^c#FF8000^" # <--- S·ª¨A S·ªê N√ÄY N·∫æU CH∆ØA RA M√ÄU V√ÄNG (Th·ª≠ 3, 4, 5, 11...)
COL_RED="^C9^"          # M√†u ƒë·ªè
COL_DEFAULT="^C4^"      # M√†u m·∫∑c ƒë·ªãnh cho Icon (Blue?)
COL_TEXT="^C15^"        # M√†u tr·∫Øng cho ch·ªØ

# ==========================================
# 1. X·ª¨ L√ù S·ª∞ KI·ªÜN
# ==========================================
case $BLOCK_BUTTON in
1) notify-send "üîã Battery Info" "Status: $(cat /sys/class/power_supply/BAT0/status 2>/dev/null)
Capacity: $(cat /sys/class/power_supply/BAT0/capacity 2>/dev/null)%" ;;
3) notify-send "üîã Battery module" "üîã: discharging\nüõë: not charging\n‚ôª: stagnant charge\nüîå: charging\n‚ö°: charged\n‚ùó: battery very low!\n- Scroll to adjust brightness." ;;
4) brightnessctl set +1% ;;
5) brightnessctl set 1%- ;;
6) setsid -f "$TERMINAL" -e "$EDITOR" "$0" ;;
esac

BAT="/sys/class/power_supply/BAT0"
[ ! -d "$BAT" ] && BAT="/sys/class/power_supply/BAT1"

# Read once to vars
STAT=$(cat "$BAT/status" 2>/dev/null)
CAP=$(cat "$BAT/capacity" 2>/dev/null)

# ==========================================
# 2. X·ª¨ L√ù ICON V√Ä LOGIC M√ÄU
# ==========================================
WARN=""
ICON_COLOR="$COL_DEFAULT"

case "$STAT" in
"Charging")
  ICON="üîå"
  ICON_COLOR="$COL_GREEN"
  ;;
"Not charging")
  ICON="üõë"
  ICON_COLOR="$COL_TEXT"
  ;;
"Unknown")
  ICON="‚ôªÔ∏è"
  ICON_COLOR="$COL_TEXT"
  ;;
"Full")
  ICON="‚ö° "
  ICON_COLOR="$COL_GREEN"
  ;;
"Discharging")
  # Gi·ªØ nguy√™n kho·∫£ng tr·∫Øng (space) ph√≠a sau icon nh∆∞ c≈©
  if [ "$CAP" -ge 90 ]; then
    ICON="ÔâÄ "
  elif [ "$CAP" -ge 75 ]; then
    ICON="ÔâÅ "
  elif [ "$CAP" -ge 50 ]; then
    ICON="ÔâÇ "
  elif [ "$CAP" -ge 25 ]; then
    ICON="ÔâÉ "
  else
    ICON="ÔâÑ "
  fi

  # Logic C·∫£nh b√°o
  if [ "$CAP" -le 10 ]; then
    WARN="üÜò"
  elif [ "$CAP" -le 25 ]; then
    WARN="‚ùó"
  fi

  # Logic M√ÄU ICON (D√πng bi·∫øn ƒë√£ ƒë·ªãnh nghƒ©a ·ªü tr√™n)
  if [ "$CAP" -gt 75 ]; then
    ICON_COLOR="$COL_GREEN"
  elif [ "$CAP" -gt 50 ]; then
    ICON_COLOR="$COL_LIGHTBLUE"
  elif [ "$CAP" -gt 25 ]; then
    ICON_COLOR="$COL_YELLOW" # <--- N√≥ s·∫Ω l·∫•y m√†u b·∫°n set ·ªü ƒë·∫ßu file
  else
    ICON_COLOR="$COL_RED"
  fi
  ;;
*)
  ICON="üîã"
  ;;
esac

# ==========================================
# 3. HI·ªÇN TH·ªä
# ==========================================
# Format: [M√†u Icon][Icon+Warn] [M√†u ch·ªØ][S·ªë %][Reset]
printf "%s%s%s%s%%^d^" "$ICON_COLOR" "$ICON$WARN" "$COL_TEXT" "$CAP"
