#!/bin/sh
# shot â€” unified screenshot tool (X11)

APP="ðŸ“¸ Screenshot"
DIR="$HOME/Pictures/Screenshots"

# ---------- helpers ----------

notify() {
  notify-send "$APP" "$1" ${2:+-i "$2"}
}

die() {
  notify "$1"
  exit 1
}

need() {
  command -v "$1" >/dev/null 2>&1 || die "Missing dependency: $1"
}

timestamp() {
  date +%F_%H-%M-%S
}

ensure_dir() {
  mkdir -p "$DIR" || die "Cannot create $DIR"
}

# ---------- checks ----------

check_deps() {
  need maim
  need notify-send
}

check_window_deps() {
  check_deps
  need xdotool
}

# ---------- actions ----------

shot_screen() {
  check_deps
  ensure_dir
  FILE="$DIR/screen_$(timestamp).png"
  maim "$FILE" || die "Failed to capture screen"
  notify "Saved full screenshot" "$FILE"
}

shot_area() {
  check_deps
  ensure_dir
  FILE="$DIR/area_$(timestamp).png"
  maim -s "$FILE" || die "Selection cancelled"
  notify "Saved area selection" "$FILE"
}

shot_window() {
  check_window_deps
  ensure_dir
  WIN="$(xdotool getactivewindow 2>/dev/null)" || die "No active window"
  FILE="$DIR/window_$(timestamp).png"
  maim -i "$WIN" "$FILE" || die "Failed to capture window"
  notify "Saved active window" "$FILE"
}

# ---------- ui ----------

usage() {
  cat <<EOF
Usage: shot <command>

Commands:
  screen    Capture full screen
  area      Capture selected area
  window    Capture active window
  check     Check dependencies
  help      Show this help

Examples:
  shot screen
  shot area
  shot window
EOF
}

check_only() {
  check_window_deps
  notify "All dependencies satisfied"
}

# ---------- main ----------

case "$1" in
  screen) shot_screen ;;
  area)   shot_area ;;
  window) shot_window ;;
  check)  check_only ;;
  help|"") usage ;;
  *)
    die "Unknown command: $1 (use: shot help)"
    ;;
esac

