#!/bin/sh

# Ghi log lỗi ra file để đọc
exec > ~/.xinitrc-errors.log 2>&1

echo "Start xinitrc..."

# 1. Load Profile
[ -f "$HOME/.config/shell/profile" ] && . "$HOME/.config/shell/profile"

# 2. Load Xprofile
[ -f "$HOME/.config/x11/xprofile" ] && . "$HOME/.config/x11/xprofile"

echo "Loaded profile. Starting DWM..."

# 3. START DWM (An toàn hơn)
# Kiểm tra xem dwm có tồn tại không
if ! command -v dwm >/dev/null; then
    echo "ERROR: DWM not found in PATH!"
    # Fallback để không bị crash: mở xterm giữ nhịp
    exec xterm
fi

# Thử chạy đơn giản trước (Bỏ dbus/ssh-agent tạm thời để test)
# exec dwm

# Nếu muốn test full dòng lệnh pro:
if [ -z "$DBUS_SESSION_BUS_ADDRESS" ] && command -v dbus-launch >/dev/null; then
    exec ssh-agent dbus-launch --exit-with-session dwm
else
    exec ssh-agent dwm
fi
