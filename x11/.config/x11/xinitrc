#!/bin/sh

# 1. Load Environment (PATH, EDITOR...)
# Tách biệt file profile để dùng chung cho cả Zsh và Bash
[ -f "$HOME/.config/shell/profile" ] && . "$HOME/.config/shell/profile"

# 2. Load Resources (Màu sắc giao diện cho ST/DWM)
[ -f "$HOME/.config/x11/xresources" ] && xrdb -merge "$HOME/.config/x11/xresources"

# 3. Gọi Hậu cần (.xprofile)
[ -f "$HOME/.config/x11/xprofile" ] && . "$HOME/.config/x11/xprofile"

# 4. EXEC: Khởi động Window Manager (DWM)
# - ssh-agent: Giữ key SSH trong suốt phiên làm việc.
# - dbus-launch: Khởi tạo message bus cho session.
# - --exit-with-session: Kill dbus khi thoát DWM.

if [ -z "$DBUS_SESSION_BUS_ADDRESS" ]; then
    exec ssh-agent dbus-launch --exit-with-session dwm
else
    # Fallback cho trường hợp systemd đã load dbus (thường gặp trên NixOS Graphical)
    exec ssh-agent dwm
fi
